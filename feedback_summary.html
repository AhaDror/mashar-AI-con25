<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סיכום משוב כנס AI - מש"ר 2025</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1e1b4b 50%, #581c87 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid rgba(139, 92, 246, 0.3);
            margin-bottom: 40px;
        }

        .main-title {
            font-size: 3.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #dc2626);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
            animation: titlePulse 3s ease-in-out infinite alternate;
        }

        @keyframes titlePulse {
            0% {
                filter: brightness(1);
            }
            100% {
                filter: brightness(1.3);
            }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #e2e8f0;
            margin-bottom: 20px;
        }

        .back-btn {
            display: inline-block;
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #e2e8f0;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(139, 92, 246, 0.3);
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.15), rgba(220, 38, 38, 0.1));
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(251, 191, 36, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(251, 191, 36, 0.3);
            border-color: rgba(251, 191, 36, 0.5);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #fbbf24, #f59e0b, #dc2626, #fbbf24);
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        .stat-number {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #dc2626);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            animation: numberGlow 2s ease-in-out infinite alternate;
        }

        @keyframes numberGlow {
            0% {
                filter: brightness(1);
                transform: scale(1);
            }
            100% {
                filter: brightness(1.2);
                transform: scale(1.05);
            }
        }

        .stat-label {
            font-size: 1.1rem;
            color: #ffffff;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            color: #ffffff;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bar-label {
            min-width: 200px;
            font-weight: 600;
            color: #e2e8f0;
        }

        .bar-container {
            flex: 1;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            border-radius: 15px;
            transition: width 1s ease;
            position: relative;
            width: 0%;
        }

        .bar-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .insight-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(16, 185, 129, 0.08));
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .insight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #10b981, #06b6d4);
        }

        .insight-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #ffffff;
        }

        .insight-content {
            color: #e2e8f0;
            line-height: 1.6;
        }

        .quotes-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .quote {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(16, 185, 129, 0.1));
            border-left: 4px solid #10b981;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            font-style: italic;
            position: relative;
        }

        .quote::before {
            content: '"';
            font-size: 3rem;
            color: #8b5cf6;
            position: absolute;
            top: -10px;
            right: 15px;
            opacity: 0.5;
        }

        .quote-text {
            color: #e2e8f0;
            margin-bottom: 10px;
        }

        .quote-author {
            color: #10b981;
            font-weight: 600;
            font-style: normal;
        }

        .recommendations {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 15px;
            padding: 30px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .recommendation-icon {
            background: linear-gradient(135deg, #10b981, #06b6d4);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .recommendation-text {
            color: #e2e8f0;
            flex: 1;
        }

        .pie-chart {
            width: 300px;
            height: 300px;
            margin: 0 auto;
            border-radius: 50%;
            position: relative;
        }

        .pie-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .legend-text {
            color: #e2e8f0;
            font-weight: 600;
        }

        .data-note {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #e2e8f0;
            font-style: italic;
        }

        .accordion-container {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(16, 185, 129, 0.1));
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .accordion-header:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(16, 185, 129, 0.15));
        }

        .accordion-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: #ffffff;
        }

        .accordion-arrow {
            font-size: 1.2rem;
            color: #8b5cf6;
            transition: transform 0.3s ease;
        }

        .accordion-content {
            display: none;
            padding: 25px;
        }

        .feedback-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .feedback-category {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 20px;
        }

        .feedback-category h4 {
            font-size: 1.1rem;
            color: #10b981;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(16, 185, 129, 0.3);
            padding-bottom: 8px;
        }

        .feedback-item {
            background: rgba(255, 255, 255, 0.05);
            border-right: 3px solid #8b5cf6;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .feedback-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(-3px);
        }

        .feedback-text {
            color: #e2e8f0;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .feedback-author {
            color: #10b981;
            font-weight: 600;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }

            .bar-label {
                min-width: 150px;
                font-size: 0.9rem;
            }

            .pie-chart {
                width: 250px;
                height: 250px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">📊 סיכום משוב כנס AI</h1>
            <p class="subtitle">מש"ר ראשון לציון • 3 יולי 2025</p>
            <a href="index.html" class="back-btn">🏠 חזרה לדף הכנס</a>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <h3>טוען נתוני משוב...</h3>
            <p>קורא מקובץ CSV ומחשב סטטיסטיקות</p>
        </div>

        <!-- Main Content (hidden initially) -->
        <div id="main-content" style="display: none;">
            <!-- Data Source Note -->
            <div class="data-note">
                📊 הנתונים מתעדכנים אוטומטית מקובץ המשוב • עדכון אחרון: <span id="last-updated"></span>
            </div>

            <!-- Key Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">62</div>
                    <div class="stat-label">נרשמו לכנס</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">55</div>
                    <div class="stat-label">השתתפו בסדנאות</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="feedback-responses">-</div>
                    <div class="stat-label">ענו על שאלון משוב</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="overall-satisfaction">-</div>
                    <div class="stat-label">ציון שביעות רצון כללית</div>
                </div>
            </div>

            <!-- Workshop Ratings -->
            <div class="section">
                <h2 class="section-title">🎯 ציונים לסדנאות</h2>
                <div class="chart-container">
                    <h3 class="chart-title">ממוצע ציונים לכל סדנה (1-5)</h3>
                    <div class="bar-chart" id="workshop-chart">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Lecture Ratings -->
            <div class="section">
                <h2 class="section-title">🎤 ציונים להרצאות</h2>
                <div class="chart-container">
                    <h3 class="chart-title">ממוצע ציונים להרצאות (1-5)</h3>
                    <div class="bar-chart" id="lecture-chart">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Geographic Distribution -->
            <div class="section">
                <h2 class="section-title">🗺️ התפלגות גיאוגרפית של המשיבים</h2>
                <div class="chart-container">
                    <h3 class="chart-title">התפלגות לפי מרכזי עבודה</h3>
                    <div class="pie-chart" id="geo-chart"></div>
                    <div class="pie-legend" id="geo-legend">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Experience Level Distribution -->
            <div class="section">
                <h2 class="section-title">📈 רמות ניסיון של המשתתפים</h2>
                <div class="chart-container">
                    <h3 class="chart-title">התפלגות רמות ניסיון עם AI לפני הכנס</h3>
                    <div class="bar-chart" id="experience-chart">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Key Insights -->
            <div class="section">
                <h2 class="section-title">💡 תובנות עיקריות</h2>
                <div class="insights-grid" id="insights-grid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Participant Quotes -->
            <div class="section">
                <h2 class="section-title">💬 ציטוטים מהמשתתפים</h2>
                <div class="quotes-section" id="quotes-section">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Recommendations -->
            <div class="section">
                <h2 class="section-title">🚀 המלצות לעתיד</h2>
                <div class="recommendations">
                    <div class="recommendation-item">
                        <div class="recommendation-icon">1</div>
                        <div class="recommendation-text">
                            <strong>יותר זמן לסדנאות:</strong> להקצות 90-120 דקות לכל סדנה במקום 75 דקות, כדי לאפשר
                            תרגול מעמיק יותר.
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">2</div>
                        <div class="recommendation-text">
                            <strong>דוגמאות מוכנות מראש:</strong> להכין תבניות ופרומפטים מוכנים כנקודת התחלה למשתתפים
                            ברמות שונות.
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">3</div>
                        <div class="recommendation-text">
                            <strong>מנוי ארגוני:</strong> לשקול רכישת מנויים לכלי AI מתקדמים עבור המורים, כפי שהוצע
                            במשוב.
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">4</div>
                        <div class="recommendation-text">
                            <strong>מעקב והמשכיות:</strong> לארגן מפגשי המשך או קבוצות עבודה לשיתוף ניסיון וטיפוח השימוש
                            ב-AI.
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">5</div>
                        <div class="recommendation-text">
                            <strong>התמחות לפי נושאים:</strong> בכנס הבא לשקול סדנאות מתמחות יותר לפי מקצועות או רמות
                            ניסיון.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="header"
                style="border-top: 2px solid rgba(139, 92, 246, 0.3); border-bottom: none; margin-top: 40px; margin-bottom: 0;">
                <h2 style="font-size: 1.5rem; margin-bottom: 20px;">🙏 תודה למשתתפים</h2>
                <p style="margin-bottom: 20px;">המשוב שלכם חשוב לנו ויעזור לשפר כנסים עתידיים</p>
                <a href="index.html" class="back-btn">🏠 חזרה לדף הכנס</a>
            </div>
        </div>
    </div>

    <script>
        // CSV parsing utility
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = parseCSVLine(lines[0]);

            // Debug: Log headers
            console.log('CSV Headers:', headers);

            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length >= headers.length) {
                        const row = {};
                        headers.forEach((header, index) => {
                            row[header] = values[index] ? values[index].trim() : '';
                        });
                        data.push(row);
                    }
                }
            }

            // Debug: Log first few rows
            console.log('First 3 data rows:', data.slice(0, 3));

            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        // Calculate statistics from data
        function calculateStats(data) {
            const stats = {
                totalResponses: data.length,
                locations: {},
                experienceLevel: {},
                workshopRatings: {},
                lectureRatings: {},
                satisfactionScores: [],
                implementationReadiness: [],
                quotes: []
            };

            data.forEach(row => {
                // Location distribution
                const workCenter = row['אני עובד.ת במרכז:'];
                if (workCenter && workCenter.trim() !== '') {
                    const cleanWorkCenter = workCenter.trim();
                    stats.locations[cleanWorkCenter] = (stats.locations[cleanWorkCenter] || 0) + 1;
                }

                // Experience level
                const experience = row['רמת הניסיון שלכם עם AI לפני הכנס:'];
                if (experience && experience.trim() !== '') {
                    const cleanExperience = experience.trim();
                    stats.experienceLevel[cleanExperience] = (stats.experienceLevel[cleanExperience] || 0) + 1;
                }

                // Workshop ratings
                const workshopColumns = [
                    '📊 סדנה 1: מהשאלה – לפתרון, מהפתרון – למחוון',
                    '✅ סדנה 2: בדיקת מטלות עם כלי AI',
                    '🎓 סדנה 3: לשלב AI בכיתה',
                    '💻 סדנה 4: פיתוח ללא מתכנתים',
                    '🏢 סדנה 5: מה עושים עם AI בעבודה?'
                ];

                workshopColumns.forEach(workshop => {
                    const ratingValue = row[workshop];
                    if (ratingValue && ratingValue.trim() !== '') {
                        const rating = parseFloat(ratingValue);
                        if (!isNaN(rating) && rating > 0 && rating <= 5) {
                            if (!stats.workshopRatings[workshop]) {
                                stats.workshopRatings[workshop] = [];
                            }
                            stats.workshopRatings[workshop].push(rating);
                        }
                    }
                });

                // Lecture ratings
                const lectureColumns = [
                    'הרצאה - דרור אהרוני',
                    'הרצאה - רועי צזנה'
                ];

                lectureColumns.forEach(lecture => {
                    const ratingValue = row[lecture];
                    if (ratingValue && ratingValue.trim() !== '') {
                        const rating = parseFloat(ratingValue);
                        if (!isNaN(rating) && rating > 0 && rating <= 5) {
                            if (!stats.lectureRatings[lecture]) {
                                stats.lectureRatings[lecture] = [];
                            }
                            stats.lectureRatings[lecture].push(rating);
                        }
                    }
                });

                // Satisfaction scores
                const satisfactionValue = row['עד כמה הכנס עמד בציפיות שלכם?'];
                if (satisfactionValue && satisfactionValue.trim() !== '') {
                    const satisfaction = parseFloat(satisfactionValue);
                    if (!isNaN(satisfaction) && satisfaction > 0 && satisfaction <= 5) {
                        stats.satisfactionScores.push(satisfaction);
                    }
                }

                // Implementation readiness
                const readinessValue = row['באיזה מידה תרגישו מוכנים ליישם את מה שלמדתם?'];
                if (readinessValue && readinessValue.trim() !== '') {
                    const readiness = parseFloat(readinessValue);
                    if (!isNaN(readiness) && readiness > 0 && readiness <= 5) {
                        stats.implementationReadiness.push(readiness);
                    }
                }

                // Collect meaningful quotes
                const additionalComments = row['הערות נוספות:'];
                const name = row['שם מלא'];
                const authorLocation = row['אני עובד.ת במרכז:'];

                if (additionalComments && additionalComments.length > 50 && name) {
                    stats.quotes.push({
                        text: additionalComments,
                        author: `${name}, ${authorLocation}`
                    });
                }
            });

            // Debug: Log stats for verification
            console.log('Stats Summary:', {
                totalResponses: stats.totalResponses,
                locations: stats.locations,
                experienceLevel: stats.experienceLevel,
                workshopRatings: Object.keys(stats.workshopRatings).map(w => ({
                    workshop: w,
                    count: stats.workshopRatings[w].length,
                    average: (stats.workshopRatings[w].reduce((a, b) => a + b, 0) / stats.workshopRatings[w].length).toFixed(2)
                })),
                lectureRatings: Object.keys(stats.lectureRatings).map(l => ({
                    lecture: l,
                    count: stats.lectureRatings[l].length,
                    average: (stats.lectureRatings[l].reduce((a, b) => a + b, 0) / stats.lectureRatings[l].length).toFixed(2)
                })),
                avgSatisfaction: stats.satisfactionScores.length > 0 ? (stats.satisfactionScores.reduce((a, b) => a + b, 0) / stats.satisfactionScores.length).toFixed(2) : 'N/A',
                avgReadiness: stats.implementationReadiness.length > 0 ? (stats.implementationReadiness.reduce((a, b) => a + b, 0) / stats.implementationReadiness.length).toFixed(2) : 'N/A'
            });

            return stats;
        }

        // Render functions
        function renderKeyStats(stats) {
            // Update only dynamic statistics (62 registered and 55 workshop participants are fixed)
            document.getElementById('feedback-responses').textContent = stats.totalResponses;

            const avgSatisfaction = stats.satisfactionScores.length > 0
                ? (stats.satisfactionScores.reduce((a, b) => a + b, 0) / stats.satisfactionScores.length).toFixed(1)
                : '-';
            document.getElementById('overall-satisfaction').textContent = avgSatisfaction;
        }

        function renderWorkshopChart(stats) {
            const container = document.getElementById('workshop-chart');
            container.innerHTML = '';

            const workshopNames = {
                '📊 סדנה 1: מהשאלה – לפתרון, מהפתרון – למחוון': '📊 מהשאלה לפתרון',
                '✅ סדנה 2: בדיקת מטלות עם כלי AI': '✅ בדיקת מטלות עם AI',
                '🎓 סדנה 3: לשלב AI בכיתה': '🎓 לשלב AI בכיתה',
                '💻 סדנה 4: פיתוח ללא מתכנתים': '💻 פיתוח ללא מתכנתים',
                '🏢 סדנה 5: מה עושים עם AI בעבודה?': '🏢 מה עושים עם AI בעבודה'
            };

            const sortedWorkshops = Object.entries(stats.workshopRatings)
                .map(([workshop, ratings]) => ({
                    name: workshopNames[workshop] || workshop,
                    average: ratings.reduce((a, b) => a + b, 0) / ratings.length,
                    count: ratings.length
                }))
                .sort((a, b) => b.average - a.average);

            sortedWorkshops.forEach(workshop => {
                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                barItem.innerHTML = `
                    <div class="bar-label">${workshop.name}</div>
                    <div class="bar-container">
                        <div class="bar-fill" data-value="${(workshop.average / 5 * 100).toFixed(0)}">
                            <div class="bar-value">${workshop.average.toFixed(1)} (${workshop.count})</div>
                        </div>
                    </div>
                `;
                container.appendChild(barItem);
            });
        }

        function renderLectureChart(stats) {
            const container = document.getElementById('lecture-chart');
            container.innerHTML = '';

            const lectureNames = {
                'הרצאה - דרור אהרוני': 'דרור משה אהרוני - יכולות AI כיום',
                'הרצאה - רועי צזנה': 'ד"ר רועי צזנה - העתידים הצפויים'
            };

            Object.entries(stats.lectureRatings).forEach(([lecture, ratings]) => {
                const average = ratings.reduce((a, b) => a + b, 0) / ratings.length;
                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                barItem.innerHTML = `
                    <div class="bar-label">${lectureNames[lecture] || lecture}</div>
                    <div class="bar-container">
                        <div class="bar-fill" data-value="${(average / 5 * 100).toFixed(0)}">
                            <div class="bar-value">${average.toFixed(1)} (${ratings.length})</div>
                        </div>
                    </div>
                `;
                container.appendChild(barItem);
            });
        }

        function renderGeographicChart(stats) {
            const colors = ['#8b5cf6', '#10b981', '#06b6d4', '#f59e0b', '#ef4444', '#84cc16', '#f97316'];
            const total = Object.values(stats.locations).reduce((a, b) => a + b, 0);

            let cumulativePercentage = 0;
            let gradientStops = [];
            const legendContainer = document.getElementById('geo-legend');
            legendContainer.innerHTML = '';

            Object.entries(stats.locations).forEach(([location, count], index) => {
                const percentage = (count / total) * 100;
                const color = colors[index % colors.length];

                gradientStops.push(`${color} ${cumulativePercentage}% ${cumulativePercentage + percentage}%`);
                cumulativePercentage += percentage;

                // Add legend item
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background: ${color};"></div>
                    <div class="legend-text">${location} (${count})</div>
                `;
                legendContainer.appendChild(legendItem);
            });

            const pieChart = document.getElementById('geo-chart');
            pieChart.style.background = `conic-gradient(${gradientStops.join(', ')})`;
        }

        function renderExperienceChart(stats) {
            const container = document.getElementById('experience-chart');
            container.innerHTML = '';

            Object.entries(stats.experienceLevel).forEach(([level, count]) => {
                const percentage = (count / stats.totalResponses) * 100;
                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                barItem.innerHTML = `
                    <div class="bar-label">${level}</div>
                    <div class="bar-container">
                        <div class="bar-fill" data-value="${percentage.toFixed(0)}">
                            <div class="bar-value">${count} (${percentage.toFixed(0)}%)</div>
                        </div>
                    </div>
                `;
                container.appendChild(barItem);
            });
        }

        function renderInsights(stats) {
            const container = document.getElementById('insights-grid');
            container.innerHTML = '';

            const avgImplementation = stats.implementationReadiness.length > 0
                ? (stats.implementationReadiness.reduce((a, b) => a + b, 0) / stats.implementationReadiness.length).toFixed(1)
                : 0;

            const beginnerCount = (stats.experienceLevel['מתחיל'] || 0);
            const basicCount = (stats.experienceLevel['בסיסי'] || 0);
            const beginnerPercentage = (beginnerCount + basicCount) / stats.totalResponses * 100;

            const insights = [
                {
                    title: '🎯 התאמה מושלמת לצרכים',
                    content: `הסדנאות התאימו במדויק לצרכים שזוהו מראש: בדיקת מבחנים, יצירת תוכן חינוכי, ופיתוח כלים טכנולוגיים. על סמך ${stats.totalResponses} משיבים.`
                },
                {
                    title: '📈 רמת ניסיון מגוונת',
                    content: `${beginnerPercentage.toFixed(0)}% מהמשתתפים הגיעו עם רמת ניסיון בסיסית או מתחילה, מה שמדגיש את הצורך בהכשרת מורים בנושא AI.`
                },
                {
                    title: '⚡ דגש על פרקטיקה',
                    content: `המשוב העיקרי היה בקשה ליותר זמן תרגול ודוגמאות מעשיות. המשתתפים רצו פחות תיאוריה ויותר "לשים יד על האמת".`
                },
                {
                    title: '🌟 השפעה ארוכת טווח',
                    content: `ממוצע של ${avgImplementation}/5 במוכנות ליישום מה שנלמד, מה שמעיד על הערך המעשי של הכנס ועל הפוטנציאל להשפעה ארוכת טווח.`
                }
            ];

            insights.forEach(insight => {
                const card = document.createElement('div');
                card.className = 'insight-card';
                card.innerHTML = `
                    <h3 class="insight-title">${insight.title}</h3>
                    <div class="insight-content">${insight.content}</div>
                `;
                container.appendChild(card);
            });
        }

        function renderQuotes(stats) {
            const container = document.getElementById('quotes-section');
            container.innerHTML = '';

            // Featured quotes (best representative feedback)
            const featuredQuotes = [
                {
                    text: "הסדנאות התאימו במדויק לצרכים שזוהו מראש: בדיקת מבחנים, יצירת תוכן חינוכי, ופיתוח כלים טכנולוגיים. אני חושבת שהיה מאד חשוב ופרקטי ומעודד להתחבר לכלים והיכולות לשיפור היעילות באופן יום יומי ופרקטי",
                    author: "שולי אייל, ראשון לציון"
                },
                {
                    text: "באמת שהכל אפשרי בעולם שלנו כיום. למרות זאת, זו רק ההתחלה ולכן פיתוח אוריינות AI היא משהו שצריך להשקיע בו זמן ע\"מ להבין כיצד לנצל את הכוח האדיר הזה. הכנס בכללותו עורר מחשבות על תפקיד המורים בעתיד ובפרט לפיזיקה....מסקרן!",
                    author: "אבי גרולמן, רחובות"
                },
                {
                    text: "למדתי לטייב את העבודה עם הכלים ועל ידי כך להשיג תוצאות טובות יותר בעבודתי כמורה. קיבלתי כמה רעיונות ואנקדוטות לאופן ביצוע לימוד עצמי בעזרת AI",
                    author: "יובל סגל, רחובות"
                },
                {
                    text: "את ההבנה שאפשר לעשות דברים מדהימים גם אם אתה לא מתכנת. הסדנה והבצוע של דרור עזר לנו להתחיל ומשם כבר היינו עצמאיים מספיק להגיע לתוצאות טובות בזמן קצר",
                    author: "ניר יונה, רחובות"
                }
            ];

            // Render featured quotes
            featuredQuotes.forEach(quote => {
                const quoteElement = document.createElement('div');
                quoteElement.className = 'quote';
                quoteElement.innerHTML = `
                    <div class="quote-text">${quote.text}</div>
                    <div class="quote-author">- ${quote.author}</div>
                `;
                container.appendChild(quoteElement);
            });

            // Add accordion for all feedback
            const accordionContainer = document.createElement('div');
            accordionContainer.className = 'accordion-container';
            accordionContainer.innerHTML = `
                <div class="accordion-header" onclick="toggleAccordion()">
                    <h3>🔍 הערות נוספות מהמשתתפים</h3>
                    <span class="accordion-arrow">▼</span>
                </div>
                <div class="accordion-content" id="all-feedback">
                    <div class="feedback-categories">
                        <div class="feedback-category">
                            <h4>💡 על הסדנאות</h4>
                            <div class="feedback-items" id="workshop-feedback"></div>
                        </div>
                        <div class="feedback-category">
                            <h4>🎤 על ההרצאות</h4>
                            <div class="feedback-items" id="lecture-feedback"></div>
                        </div>
                        <div class="feedback-category">
                            <h4>🚀 הצעות לשיפור</h4>
                            <div class="feedback-items" id="improvement-feedback"></div>
                        </div>
                        <div class="feedback-category">
                            <h4>🎯 משוב כללי</h4>
                            <div class="feedback-items" id="general-feedback"></div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(accordionContainer);

            // Populate accordion with categorized feedback
            populateAccordionFeedback(stats);
        }

        function populateAccordionFeedback(stats) {
            const workshopFeedback = document.getElementById('workshop-feedback');
            const lectureFeedback = document.getElementById('lecture-feedback');
            const improvementFeedback = document.getElementById('improvement-feedback');
            const generalFeedback = document.getElementById('general-feedback');

            // Clear containers
            workshopFeedback.innerHTML = '';
            lectureFeedback.innerHTML = '';
            improvementFeedback.innerHTML = '';
            generalFeedback.innerHTML = '';

            // All feedback data from CSV
            const allFeedback = [
                {
                    category: 'workshop',
                    text: "הסדנאות פונות למגוון רמות. עם זאת, ניתן ליישר קו ולהראות את היכולות\\הפונקציות\\הרעיונות בעזרת לפחות דוגמה אחת מוכנה מראש, ומשם שהמתקדמים בתחום יקחו את זה לאן שמתאים להם.",
                    author: "ודים אוזרסקי, ראשון לציון"
                },
                {
                    category: 'workshop',
                    text: "בעיני היה צורך בהדגמה יותר \"מוחשית\" - רצף של פרומפטים ותוצרים עד להגעה לתוצר מוגמר. בנוסף דרושה יותר משעה של עבודה עצמית לשם הגעה לתוצר מוגמר.",
                    author: "יובל סגל, רחובות"
                },
                {
                    category: 'lecture',
                    text: "להבין מה אפשר לעשות ומה המגבלות. מה התפקיד שלנו כשיש כלים שיכולים לעשות הרבה מאוד.",
                    author: "שני אפיקי, ראשון לציון"
                },
                {
                    category: 'lecture',
                    text: "לראות בלייב את קצב האבולוציה ההזוי של כלי ההנפשה והווידאו השונים, ולשמוע דוגמאות מעניינות על ההשתפרות של המודלים באינטראקציה עם בני אדם",
                    author: "אבי גרולמן, רחובות"
                },
                {
                    category: 'improvement',
                    text: "הסדנאות צריכות להיות מורחבות יותר לתרגול. אם מתרגלים את השימושים השונים צריך לתת יותר זמן להעמקת הנושא.",
                    author: "זאב זיניוק, חמד\"ע"
                },
                {
                    category: 'improvement',
                    text: "בכנס הבא הייתי מעדיף הרצאה אחת ויותר זמן לסדנאות פרקטיות",
                    author: "אבי גרולמן, רחובות"
                },
                {
                    category: 'improvement',
                    text: "זמן לשאלות אחרי ההרצאות, סדנאות עם תוצרים ברורים יותר",
                    author: "יונית סגל, נגב מערבי"
                },
                {
                    category: 'improvement',
                    text: "הייתי יוזם הפסקה קצרה בין ההרצאות",
                    author: "ניר יונה, רחובות"
                },
                {
                    category: 'general',
                    text: "הערכה רבה מאד לכל יוזמי הכנס ומבצעיו על ההשקעה בהכנתו , הירידה לפרטים והאווירה המצוינת. תענוג!",
                    author: "אבי גרולמן, רחובות"
                },
                {
                    category: 'general',
                    text: "היה מוצלח מאוד בעיניי, נתן הרבה רעיונות לפעולה וליישום עתידי. כדאי שיהיה לנו מנוי ארגוני למודלים שבהם יש הבדל משמעותית בין הגרסה בתשלום לחינמית.",
                    author: "יוליה ברונשטיין, ראשון לציון"
                },
                {
                    category: 'general',
                    text: "צריך לתרגל הרבה כדי להגיע לרמה טובה. הסדנאות צריכות לקחת יותר זמן תרגול.",
                    author: "זאב זיניוק, חמד\"ע"
                },
                {
                    category: 'general',
                    text: "נהנתי מאוד ואשמח להגיע לכנסים דומים בהמשך!",
                    author: "יונית סגל, נגב מערבי"
                }
            ];

            // Populate each category
            allFeedback.forEach(feedback => {
                const feedbackElement = document.createElement('div');
                feedbackElement.className = 'feedback-item';
                feedbackElement.innerHTML = `
                    <div class="feedback-text">${feedback.text}</div>
                    <div class="feedback-author">- ${feedback.author}</div>
                `;

                switch (feedback.category) {
                    case 'workshop':
                        workshopFeedback.appendChild(feedbackElement);
                        break;
                    case 'lecture':
                        lectureFeedback.appendChild(feedbackElement);
                        break;
                    case 'improvement':
                        improvementFeedback.appendChild(feedbackElement);
                        break;
                    case 'general':
                        generalFeedback.appendChild(feedbackElement);
                        break;
                }
            });
        }

        function toggleAccordion() {
            const accordion = document.getElementById('all-feedback');
            const arrow = document.querySelector('.accordion-arrow');
            
            if (accordion.style.display === 'none' || accordion.style.display === '') {
                accordion.style.display = 'block';
                arrow.textContent = '▲';
            } else {
                accordion.style.display = 'none';
                arrow.textContent = '▼';
            }
        }

        function animateBars() {
            const barFills = document.querySelectorAll('.bar-fill');
            setTimeout(() => {
                barFills.forEach(bar => {
                    const value = bar.getAttribute('data-value');
                    bar.style.width = value + '%';
                });
            }, 500);
        }

        // Load and process data
        async function loadFeedbackData() {
            try {
                // Try to fetch the CSV file
                const response = await fetch('./assets/CSV/feedback_data.csv');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const csvText = await response.text();

                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('קובץ CSV ריק או לא תקין');
                }

                const data = parseCSV(csvText);

                if (data.length === 0) {
                    throw new Error('לא נמצאו נתונים בקובץ CSV');
                }

                const stats = calculateStats(data);

                // Update last updated time
                document.getElementById('last-updated').textContent = new Date().toLocaleDateString('he-IL');

                // Render all components
                renderKeyStats(stats);
                renderWorkshopChart(stats);
                renderLectureChart(stats);
                renderGeographicChart(stats);
                renderExperienceChart(stats);
                renderInsights(stats);
                renderQuotes(stats);

                // Show content and hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';

                // Animate bars
                animateBars();

            } catch (error) {
                console.error('Error loading feedback data:', error);

                // Show detailed error message
                let errorMessage = '';
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage = `
                        <h3>🔒 בעיית CORS - גישה לקובץ נחסמה</h3>
                        <p>הדפדפן חוסם טעינת קבצים מקומיים מסיבות אבטחה.</p>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0; text-align: right;">
                            <h4>פתרונות אפשריים:</h4>
                            <ol style="text-align: right; margin: 10px 0;">
                                <li><strong>הרץ שרת מקומי:</strong><br/>
                                פתח terminal/cmd ונווט לתיקיית הפרויקט ורוץ:<br/>
                                <code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px;">python -m http.server 8000</code><br/>
                                ואז פתח: <a href="http://localhost:8000" target="_blank">http://localhost:8000</a>
                                </li>
                                <li><strong>השתמש ב-VSCode Live Server:</strong><br/>
                                התקן את ההרחבה "Live Server" ולחץ עליה</li>
                                <li><strong>פתח עם --disable-web-security:</strong><br/>
                                פתח את הדפדפן עם הפרמטר הזה (לא מומלץ)</li>
                            </ol>
                        </div>
                        <p><strong>קובץ הנתונים נמצא ב:</strong> assets/CSV/feedback_data.csv</p>
                    `;
                } else {
                    errorMessage = `
                        <h3>❌ שגיאה בטעינת הנתונים</h3>
                        <p><strong>פרטי השגיאה:</strong> ${error.message}</p>
                        <p>אנא בדק את הקובץ assets/CSV/feedback_data.csv</p>
                    `;
                }

                document.getElementById('loading').innerHTML = errorMessage;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', loadFeedbackData);

        // Add hover effects
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.stat-card, .insight-card, .quote').forEach(card => {
                card.addEventListener('mouseenter', function () {
                    this.style.transform = 'translateY(-5px)';
                    this.style.transition = 'all 0.3s ease';
                });

                card.addEventListener('mouseleave', function () {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>

</html>